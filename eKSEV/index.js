var eksLogo="https://raw.githubusercontent.com/roledxd/eKoolSploit/master/eKoolSploitLogoPNG.png",eKSEV={currentGroupId:null,currentGroupObj:null,currentEmployees:null,viewerHtml:function(){eKSEV.currentGroupObj;var e=eKSEV.currentGroupObj.groupData,n=eksLogo;null!==e.logoImgFn?n=eKSEV.genEkoolFilesLink(e.logoImgFn):n=eksLogo;return`<div>\n        <h3 class="modalDialogTitle">eKSEV - ${e.name}</h3>\n        <span class="avatar FL ML20 MR30 RC3 iPersonLogoImg prof"><img src="${n}"></img></span> \n        <ul class="edit leftLabels labelsInBold FL W350">\n           <li class="FWB"> <label id="eKSEV_schoolname">${e.name} (${e.id})</label> </li>\n           <li> <label></label> </li>\n           <li>\n              <div class="row" id="eKSEV_ehisId">EhisId: ${e.ehisId}</div>\n           </li>\n        </ul>\n     </div>\n     <div class="clearer"></div>\n     <div class="MT20 FWB"> <button type="button" class="g-button col-xs-4 DIB RC0" onclick='eKSEV.tabs.schoolData();'>Данные группы</button> <button type="button" class="g-button col-xs-4 DIB BL0 BR0 RC0" id='personalViewBtn' onclick='eKSEV.tabs.employees();'>Персонал</button> <button type="button" class="g-button col-xs-4 DIB RC0" onclick='eKSEV.tabs.other();'>Другое</button></div>\n     <table id="updateableregionSchoolCardEventsTable" class="fulltable withInnerColumnBorders withBottomRowBorder POSREL" border="0" cellspacing="0">\n        <tbody id="viewerFrame3">\n           <tr class="nocontent">\n              <td id="content_title" colspan="2" class="PT30 PB30">\n                 <div id="eKSEV_content">... ${e.name} ...</div>\n              </td>\n           </tr>\n        </tbody>\n     </table>`},hubHtml:`<div>\n    <h3 class="modalDialogTitle">eKSEV</h3>\n    <span class="avatar FL ML20 MR30 RC3 iPersonLogoImg prof">\n        <img id="groupImage" src="${eksLogo}">\n    </span> \n    <ul class="edit leftLabels labelsInBold FL W350">\n        <li>\n            <label>groupId:</label>\n       </li>\n       <form>\n          <input type="text" id="groupIdInput" onkeyup="eKSEV.groupIdInputChanged();" name="groupIdInput">\n       </form>\n    </ul>\n    </div>\n    <div class="clearer"></div>\n    <div class="MT20 FWB"><button type="button" class="g-button col-xs-12 DIB RC0 selected" onclick='eKSEV.openViewer();'>Load</button></div>\n    <table id="updateableregionSchoolCardEventsTable" class="fulltable withInnerColumnBorders withBottomRowBorder POSREL" border="0" cellspacing="0">\n        <tbody id="viewerFrame3">\n            <tr class="nocontent">\n                <td colspan="3" class="PT30 PB30">\n                    <div id="schoolNameById">No Group Selected</div>\n                </td>\n            </tr>\n        </tbody>\n    </table>`,tabs:{schoolData:function(){console.log("[eKSEV TAB] schoolData"),document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="Данные группы<div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px"},employees:async function(){console.log("[eKSEV TAB] employees"),document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="Персонал<div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px",await eKSEV.addEmployeesToTab()},other:function(){console.log("[eKSEV TAB] other"),document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="Другое<div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px"}},addEmployeesToTab:function(){eKSEV.currentEmployees.forEach(e=>{var n=eKSEV.generateProfileDiv(e);document.getElementById("eKSEV_content").innerHTML+=n})},show:function(){clayoutPH.initMMModalDialog({preferredWidth:550,hasCloseButton:!0,innerPadding:0}),$("modaldialog_content").update(eKSEV.hubHtml)},groupIdInputChanged:function(){var e=document.getElementById("groupIdInput").value;isNaN(e)?console.log("Inalid groupId: "+e+"!"):(console.log("Valid groupId: "+e),eKSEV.updateHubGroupInfo(e))},generateProfileDiv:function(e){if(null!==e){if(null!=e.profileImgFn)var n=eKSEV.genEkoolFilesLink(e.profileImgFn);else n=eksLogo;var t="",o="";if(eKSEV.currentGroupObj.groupAdminList.find(n=>n.id===e.id)){t="bold";o+='<span class="badge badge-success">Админ группы</span>'}return eKSEV.currentGroupObj.groupTeacherList.find(n=>n.id===e.id)&&(o+=' <span class="badge badge-primary">Учитель</span>'),html=`<div class="identity MT5" id="${e.id}-${e.name1}_${e.name2}"><hr><h2 class="h1" id="person_name">\n                <img src="${n}" class="avatar iPersonLogoImg prof MR10 POSREL" style="width:74px;height:74px;top:0px;left:0px;">\n                <span class="iProfileName ${t} h2">${e.name1} ${e.name2} </span>${o}\n                <a link href="#" onclick="console.log('${e}')" style="float:right;"class="iProfileName h2">Расширить</a>\n            </h2>\n            </div>`,html}return!1},getEmployees:function(){peopleResourceManager.getAllActiveEmployeesByInstitutionId(eKSEV.currentGroupId,{callback:function(e){eKSEV.currentEmployees=e.returnObject,eKSEV.currentEmployees.sort(function(e,n){return e.name1<n.name1?-1:e.name1>n.name1?1:0}),eKSEV.currentEmployees.sort(function(e,n){var t=eKSEV.currentGroupObj.groupTeacherList.find(n=>n.id===e.id);return t?-1:t?0:1}),eKSEV.currentEmployees.sort(function(e,n){var t=eKSEV.currentGroupObj.groupAdminList.find(n=>n.id===e.id);return t?-1:t?0:1})}})},genEkoolFilesLink:function(e){return"https://files.ekool.eu/"+e},updateGroupData:function(e){ccachePH.groupObj(e,!0,function(e){"object"!=e&&"undefined"!=e&&(eKSEV.currentGroupId=e.groupData.id,eKSEV.currentGroupObj=e,eKSEV.getEmployees())})},clearGroupData:function(){currentGroupId=null,currentGroupObj=null,currentEmployees=null},updateHubGroupInfo:function(e){document.getElementById("schoolNameById").innerText="Getting Group Data...",document.getElementById("groupImage").src=eksLogo;try{ccachePH.groupObj(e,!0,function(n){if("object"!=n&&"undefined"!=n){if(eKSEV.updateGroupData(e),null!==n.groupData.logoImgFn){var t=eKSEV.genEkoolFilesLink(n.groupData.logoImgFn);document.getElementById("groupImage").src=t}else document.getElementById("groupImage").src=eksLogo;document.getElementById("schoolNameById").innerText=n.groupData.name}else document.getElementById("schoolNameById").innerText="Invalid GroupId",document.getElementById("groupImage").src=eksLogo})}catch(e){document.getElementById("schoolNameById").innerText="Error: "+e}},openViewer:function(){null!==eKSEV.currentGroupObj?(clayoutPH.initMMModalDialog({preferredWidth:550,hasCloseButton:!0,innerPadding:0}),$("modaldialog_content").update(eKSEV.viewerHtml()),document.getElementsByClassName("ico-x_close noPrint")[0].onclick+=" eKSEV.clearGroupData();",document.getElementById("personalViewBtn").innerHTML="Персонал ("+eKSEV.currentEmployees.length+")"):chelperPH.showError("eKSEV Error","eKSEV.currentGroupId = null")}};
