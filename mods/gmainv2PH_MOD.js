//[!!!] EXECUTE AT YOUR OWN RISK.
//[!] EXECUTE ONLY AFTER VISITING SCHOOL PAGE, ELSE IT WON'T WORK.
//This mod gives you more rights on your school's page:
//- List of all the personal (not only teachers & admins) of your school.
//- List of all students of your school.
//- Access to your school classrooms list.
//- More info about your school.
//Paste the line below into your browser console and then execute
var gmainv2PH={foldername:"g",groupId:null,callback:null,personellCarousel:null,personellCarouselItemsPerPage:10,curriculaCarousel:null,toDivId:"maincontainer",absenceNoticesNotifMap:$H(),journal:{},curriculumList:[],courseList:[],permissions:null,employeeList:null,initThis:function(e){null!=$("e_ekool_schoolloc")&&$("e_ekool_schoolloc").hide();var r=SWFAddress.getParameter("groupId");r&&r>0&&(gmainv2PH.groupId=r),gmainv2PH.absenceNoticesNotifMap=$H(),ccachePH.statesList(function(e){}),ccachePH.getPhoneTypesList(function(e){}),ccachePH.getEmailTypesList(function(e){}),chelperPH.loadTemplateHidd(chelperPH.resourcedir+gmainv2PH.foldername+"/mainv2/tpl/main_tpl.html",function(){gmainv2PH.getAbsenceNoticeNotifications(),ccachePH.groupObj(gmainv2PH.groupId,!0,function(r){ccachePH.statesList(function(i){ccachePH.getPhoneTypesList(function(i){ccachePH.getEmailTypesList(function(i){var n=guserPH.userAccountTypes(this.groupId);null==guserPH.user||null==n||-1==n.indexOf(ROLES.ADMIN)&&-1==n.indexOf(ROLES.HEADMASTER)&&-1==n.indexOf(ROLES.FORMMASTER)&&-1==n.indexOf(ROLES.TEACHER)?(this.groupObj=r,this.jrnlRet=null,chelperPH.callcode(e)):$LAB.script(chelperPH.resourcedir+"g/"+chelperPH.getEffectiveJournalDir()+"/js/gjournalListPH.js?_"+chelperPH.journalRefreshForceString).wait(function(){this.groupObj=r,this.jrnlRet=null,chelperPH.callcode(e)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},initThisDivs:function(e,r){gmainv2PH.initThis(function(){var i=null;e&&(i=TemplateEngine.parseById("hidden_g_main_overview_v2_main",{mode:0}),$(gmainv2PH.toDivId).update(i)),i=TemplateEngine.parseById("hidden_stpl_3",{idPrefix:"schoolData",isAsideDiv:!1}),$(gmainv2PH.toDivId).update(i),$("maincontainer").removeClassName("PR320"),chelperPH.callcode(r)})},showJoin:function(e,r){r||(r=SWFAddress.getParameter("requestTypeId")),e&&(gmainv2PH.groupId=e),gmainv2PH.initThisDivs(!0,function(){gmainv2PH.gjoinv2Show(r)})},showAdverts:function(){"function"==typeof googletag.destroySlots&&googletag.destroySlots(),gmainv2PH.showNotificationAd(),gmainv2PH.showTowerAd()},showNotificationAd:function(){chelperPH.loadTemplateHidd(chelperPH.resourcedir+"p/main/tpl/dashboard.html",function(){var e=TemplateEngine.parseById("school_adverts_notification",null),r=$("notification_container");r&&null!=e&&r.insert({bottom:e})})},showTowerAd:function(){chelperPH.loadTemplateHidd(chelperPH.resourcedir+"p/main/tpl/dashboard.html",function(){var e=TemplateEngine.parseById("school_adverts_tower",null),r=$("tower_ad_container");r&&null!=e&&r.insert({bottom:e})})},show:function(e,r){showLoadingIndicator($("maincontainer")),chelperPH.hideNotificationArea(),null==r&&(r=!0),e&&(gmainv2PH.groupId=e),gmainv2PH.initThisDivs(r,function(){getNavigation(),void 0===navActive&&gmainv2PH.getCurrentStudyYearAndShowSchoolPage();var e=TemplateEngine.parseById("hidden_menu_inst",{inst:gmainv2PH.groupObj.groupData,showSettingsLink:!0,curricula:null});if($(gmainv2PH.toDivId).hide(),$("schoolDataheader").update(e),gmainv2PH.showButtons(),guserPH.userIsLoggedIn()){if(gmainv2PH.groupObj.assignedPlaceCount=0,null!=gmainv2PH.groupObj.designatedPlaceList)for(var r=0;r<gmainv2PH.groupObj.designatedPlaceList.size();r++)gmainv2PH.groupObj.assignedPlaceCount+=gmainv2PH.groupObj.designatedPlaceList[r].placeCount;if(null!=gmainv2PH.groupObj.confirmedPlaceList)for(var i=0;i<gmainv2PH.groupObj.confirmedPlaceList.size();i++)gmainv2PH.groupObj.assignedPlaceCount+=gmainv2PH.groupObj.confirmedPlaceList[i].placeCount;gmainv2PH.showMenu()}$(gmainv2PH.toDivId).show(),gmainv2PH.toDivId="maincontainer",navigateHash(NAV_INST_SET),hideLoadingIndicator($("maincontainer"))})},showButtons:function(){var e=null,r=$("schoolDataheader");1!=gmainv2PH.groupObj.groupData.published&&(gmainv2PH.groupObj.publishReqCount&&gmainv2PH.groupObj.publishReqCount>0||guserPH.userHasRole(gmainv2PH.groupId,ROLES.ADMIN)&&(e=TemplateEngine.parseById("hidden_g_main_publishbutton",{inst:gmainv2PH.groupObj.groupData}),r.up().insert({top:e}),r.addClassName("PT40")))},showMenu:function(){var e=gmainv2PH.getMenuItemsPermissions(gmainv2PH.groupObj.groupData),r=TemplateEngine.parseById("hidden_a_settings_fieldlist",{inst:gmainv2PH.groupObj.groupData,menuItemsPermissions:e,joinReqCount:gmainv2PH.groupObj.joinReqCount,threadCountNew:0,assignedPlaceCount:gmainv2PH.groupObj.assignedPlaceCount,interviewNotifCount:gmainv2PH.groupObj.interviewNotifCount,grdesTransferredExcerptCount:gmainv2PH.groupObj.grdesTransferredExcerptCount,isAllowedTransfer:!0,isAllowedFormativeAssesment:!0});$("schoolDatatoolbar").update(r),setTimeout(function(){clayoutPH.makePageMenuPretty()},200)},getMenuItemsPermissions:function(e){var r={requests:!0,timetable:!0,timetableAdmin:!0,reports:!0,fa:!0,recordBook:!0,interview:!0,interviewDemo:!0,descisions:!0,schoolyear:!0,recources:!0,curriculum:!0,gradesTransfer:!0,classificators:!0,addmission:!0,discipline:!0,fullDiscipline:!0,gradesTransferAdmin:!0,superAdminTool:!0,ads:!0,cafeteria:!0,devCardsTemplates:!0};return gmainv2PH.permissions=r,r},getCurrentStudyYearAndShowSchoolPage:function(){ccachePH.currentYear(gmainv2PH.groupId,function(e){gmainv2PH.showSchoolPage(e)})},showSchoolPage:function(e){chelperPH.loadTemplateHidd(chelperPH.resourcedir+"p/main/tpl/dashboard.html",function(){$LAB.script(chelperPH.resourcedir+"p/main/js/pmaindashPH.js").wait(function(){pmaindashPH.checkIfHarIDuserHasNewRoles(),gmainv2PH.showAppPromoToTeacher();var r=!0;if(gmainv2PH.groupObj.groupData.status==INST_STATUSES.OVERDUE||gmainv2PH.groupObj.groupData.status==INST_STATUSES.DISABLED){var i={title:"Данная школа просрочила оплату и услуги временно приостановлены. Пожалуйста, свяжитесь с администрацией школы для получения дальнейшей информации."};clayoutPH.nocontent("schoolDatamaincontent",i)}else{r=!0;var n=TemplateEngine.parseById("hidden_g_main_overview_v2_main_content",{showJournals:!0,groupObj:gmainv2PH.groupObj,showWarningOfCurrentYear:!0,currentYear:e,isEventsVisible:!0,teacherCanAddJournal:!0});if($("schoolDatamaincontent").update(n),r){var a=guserPH.userAccountTypes(gmainv2PH.groupId);-1==a.indexOf(ROLES.HEADMASTER)&&-1==a.indexOf(ROLES.FORMMASTER)&&-1==a.indexOf(ROLES.TEACHER)||(void 0===guserPH.user.selectedGroupId?guserPH.activateGroup(gmainv2PH.groupId,gmainv2PH.showJournals()):gmainv2PH.showJournals())}var o=guserPH.userAccountTypes(gmainv2PH.groupId);if(guserPH.userIsLoggedIn()&&null!=o&&o.size()>0){n=TemplateEngine.parseById("hidden_g_main_overview_v2_personell",{personellList:$A()}),$("g_main_overview_v2_contacts").update(n);var t=1,s=[];s.push({id:0,name:"Учителя"}),s.push({id:1,name:"Администраторы"}),s.push({id:4,name:"Школы"}),s.push({id:2,name:"специалисты по поддержке"}),s.push({id:3,name:"Ученики"}),s.push({id:5,name:"Руководство школы"}),s.push({id:20,name:"Мои ученики"}),s.push({id:7,name:"Персонал"})}var u=guserPH.getMasteredClasses(gmainv2PH.groupId);if(null!=u&&u.size()>0)for(var c=null,d=null,g=0;g<u.size();g++)d=(c=u[g]).classLevel.classLevel,null!=c.parallelIdentifier&&(d+=c.parallelIdentifier.name),s.push({id:c.id,name:d});chelperPH.sortMember(gmainv2PH.groupObj.groupAdminList,gmainv2PH.groupObj.groupData),chelperPH.sortMember(gmainv2PH.groupObj.groupTeacherList,gmainv2PH.groupObj.groupData),gmainv2PH.cfilterPH&&gmainv2PH.cfilterPH.groupId==gmainv2PH.groupId?(gmainv2PH.cfilterPH.filterDrawAndShow(),gmainv2PH.cfilterPH.filterAttachCallbacks()):(gmainv2PH.cfilterPH=new cfilterPH(s,!0,!1,gmainv2PH.personellFilterHandler.bind(gmainv2PH),t,["Поиск по имени..."],"g_main_overview_v2_contacts_personell_filter"),gmainv2PH.cfilterPH.groupId=gmainv2PH.groupId),gmainv2PH.personellFilterHandler(gmainv2PH.cfilterPH.getFilterValues().type,gmainv2PH.cfilterPH.getFilterValues().searchCriterion),clayoutPH.makePageMenuPretty(),gmainv2PH.showCurricula()&&gmainv2PH.curriculaContent(),l=!0,n=TemplateEngine.parseById("hidden_g_main_overview_v2_events",{groupObj:gmainv2PH.groupObj,isAllowedModify:l}),$("g_main_overview_v2_events").update(n),gmainv2PH.eventsList(),gmainv2PH.showBlog(),gmainv2PH.showAdverts()}})})},showCurricula:function(){return 1!=gmainv2PH.groupId},setFirstSectionSelection:function(e){$A($(e).up("div").select("a.selected")).invoke("removeClassName","selected"),$(e).addClassName("selected")},personellFilterHandler:function(e,r){showLoadingIndicator("g_main_overview_v2_contacts");var i=null;if(4==e)ccachePH.partnerList(gmainv2PH.groupId,function(i){var n=$A();i.each(function(e){n.push(e.child)}),gmainv2PH.personellFilterHandlerActivate(e,r,n,"hidden_g_main_overview_v2_personell_list_schools_items")});else if(2==e)ccachePH.shortSocialWorkerPersonList(gmainv2PH.groupId,function(i){gmainv2PH.personellFilterHandlerActivate(e,r,i)});else if(3==e)ccachePH.studentListPublic(gmainv2PH.groupId,function(i){gmainv2PH.personellFilterHandlerActivate(e,r,i)});else if(5==e)ccachePH.headMasterPersonList(gmainv2PH.groupId,function(i){gmainv2PH.personellFilterHandlerActivate(e,r,i)});else if(1==e||0==e)1==e?i=this.groupObj.groupAdminList:0==e&&(i=this.groupObj.groupTeacherList),gmainv2PH.personellFilterHandlerActivate(e,r,i);else if(7==e)ccachePH.shortStaffPersonList(gmainv2PH.groupId,function(i){gmainv2PH.personellFilterHandlerActivate(e,r,i)});else if(e==ROLES.SOCIAL_WORKER)ccachePH.getSocialWorkerPersons(dwrNumber(gmainv2PH.groupId),function(i){chelperPH.sortMember(i,gmainv2PH.groupObj.groupData),gmainv2PH.personellFilterHandlerActivate(e,r,i)});else{var n=guserPH.getMasteredClasses(gmainv2PH.groupId),a=chelperPH.arrFindById(e,n);if(null!=a){var o=a.classLevel.id,t=null;null!=a.parallelIdentifier&&(t=a.parallelIdentifier.id),ccachePH.getRegisterPersonsInClass(gmainv2PH.groupId,dwrNumber(o),dwrNumber(t),function(i){chelperPH.sortMember(i,gmainv2PH.groupObj.groupData),gmainv2PH.personellFilterHandlerActivate(e,r,i)})}else shout("formmaster is null")}},personellFilterHandlerActivate:function(e,r,i,n){if(null==n&&(n="hidden_g_main_overview_v2_personell_list_items"),null!=r&&r>""&&(i=chelperPH.arrFindBySearchStr(r,i)),i.length>500){for(var a=$A(),o=0;o<i.length&&(a.push(i[o]),500!=o);o+=1);i=a}i.length;var t=TemplateEngine.parseById(n,{arr:i,type:e});if($("g_main_overview_v2_personell_list").update(t),i.length>0){null!=gmainv2PH.personellCarousel&&(gmainv2PH.personellCarousel.purge(),gmainv2PH.personellCarousel=null);var s=$$("a.ig_main_overview_v2_personell_scroller_carousel-jumper");s.push($("g_main_overview_v2_personell_scroller_carousel_control_prev")),s.push($("g_main_overview_v2_personell_scroller_carousel_control_next")),gmainv2PH.personellCarousel=new EkoolCarousel("g_main_overview_v2_personell_scroller",$("g_main_overview_v2_personell_scroller").select(".iscroller_item"),s,{skip:gmainv2PH.personellCarouselItemsPerPage,circular:!1,jumperClassName:"ig_main_overview_v2_personell_scroller_carousel-jumper",controlClassName:"icarousel-control"});var u=$("g_main_overview_v2_personell_scroller");i.length<=gmainv2PH.personellCarouselItemsPerPage?u.addClassName("BL0 BR0 ML50"):u.removeClassName("BL0 BR0 ML50")}hideLoadingIndicator("g_main_overview_v2_contacts")},showJournals:function(){gjournalListPH.showFilter("g_main_overview_v2_tools_filter",function(){gjournalListPH.journalListTargetDivId="g_main_overview_v2_tools_list",gjournalListPH.showV2(this.jrnlRet)})},showRequests:function(){$LAB.script(chelperPH.resourcedir+"c/app/js/cappPH.js").wait(function(){$LAB.script(chelperPH.resourcedir+"a/requests/js/arequestsPH.js").wait(function(){arequestsPH.show(gmainv2PH.groupId,"schoolDatamaincontent")}.bind(this))})},timetables:function(){$LAB.script(chelperPH.resourcedir+"c/app/js/cappPH.js").wait(function(){cappPH.initAppV2(APP_LAYOUT.SIMPLE,this.appHeadTxt,{useButtons:!1,useSearch:!1},function(){$LAB.script(chelperPH.resourcedir+"g/cal/js/gcalPH.js").wait(function(){gcalPH.show(gmainv2PH.groupId)})})})},showDevCardsTemplates:function(){$LAB.script(chelperPH.resourcedir+"c/app/js/cappPH.js").wait(function(){$LAB.script(chelperPH.resourcedir+"g/mainv2/js/devcardsTemplatesPH.js").wait(function(){userAccountManager.updateXAuthCookie(guserPH.user.personId,gmainv2PH.groupId,CONTEXT.SCHOOL,function(e){devcardsTemplates.show(gmainv2PH.groupId,"schoolDatamaincontent")})}.bind(this))})},showCalendar:function(){$LAB.script(chelperPH.resourcedir+"g/cal/js/gcalPH.js").wait(function(){gcalPH.show(gmainv2PH.groupId)}.bind(this))},showBlog:function(){$LAB.script(chelperPH.resourcedir+"g/blog/js/gblogPH.js").wait(function(){gblogPH.posts(null,"g_main_overview_v2_blog",gmainv2PH.groupId)})},showReports:function(){$LAB.script(chelperPH.resourcedir+"g/reports/js/greportsPH.js").wait(function(){greportsPH.show()})},showAllGradesTranfer:function(){$LAB.script(chelperPH.resourcedir+"g/gradestransfer/js/allGradesTransferPH.js").wait(function(){allGradesTransferPH.show(gmainv2PH.groupId)})},showDecisions:function(){$LAB.script(chelperPH.resourcedir+"g/mainv2/js/decisionPH.js").wait(function(){decisionPH.show()})},showFileManager:function(){$LAB.script(chelperPH.resourcedir+"p/fileManager/js/fileManagerPH.js").wait(function(){fileManagerPH.show(CONTEXT.ME,FILEMANAGER_FILTERNAME.SCHOOL_DASH)})},showAdminTransfer:function(){$LAB.script(chelperPH.resourcedir+"a/gradetransfer/js/admintransferPH.js").wait(function(){admintransferPH.show()})},showFormativeAssessment:function(){$LAB.script(chelperPH.resourcedir+"g/formass/js/formassPH.js").wait(function(){formassPH.show(gmainv2PH.groupId)})},showFormMasterDashboard:function(){$LAB.script(chelperPH.resourcedir+"f/main/js/fmainPH.js").wait(function(){fmainPH.show()})},eventsList:function(e,r){null==e&&(e=0),gmainv2PH.eventsMode=e,r&&($("g_main_overview_v2_events").select("a.selected").invoke("removeClassName","selected"),r.addClassName("selected")),1==e?calendarManager.calendarEventsList(dwrNumber(gmainv2PH.groupId),"past",{callback:function(e){gmainv2PH.eventList=e.returnObject,gmainv2PH.eventList.sort(sortByEventDatesDesc),gmainv2PH.eventsListDraw(gmainv2PH.eventList)}}):2==e?calendarManager.calendarEventsList(dwrNumber(gmainv2PH.groupId),"all",{callback:function(e){gmainv2PH.eventList=e.returnObject,e.returnObject.sort(sortByEventDatesDesc),gmainv2PH.eventsListDraw(e.returnObject)}}):gmainv2PH.groupObj.isRecentEventList?(gmainv2PH.eventsMode=0,gmainv2PH.eventsListDraw([])):(gmainv2PH.groupObj.calendarEventList.sort(sortByEventDatesAsc),gmainv2PH.eventsListDraw(gmainv2PH.groupObj.calendarEventList))},eventsListDraw:function(e){if(0==e.length){var r={};r=1==gmainv2PH.eventsMode?{title:"За последние 30 дней событий не найдено"}:0==gmainv2PH.eventsMode?{title:"В следующие 30 дней не запланировано мероприятий."}:{title:"В этой школе не внесено ни одного события."},$("g_main_overview_v2_events_content").update('<li id = "g_main_overview_v2_events_content_linc" class="P20"></li>'),clayoutPH.nocontent("g_main_overview_v2_events_content_linc",r)}else{var i=!1;if((guserPH.userHasRole(gmainv2PH.groupId,ROLES.STAFF)||guserPH.userHasRole(gmainv2PH.groupId,ROLES.ADMIN))&&(i=!0),!$("g_main_overview_v2_events_content")){var n=TemplateEngine.parseById("hidden_g_main_overview_v2_events",{groupObj:gmainv2PH.groupObj,isAllowedModify:i});$("g_main_overview_v2_events").update(n)}var a=TemplateEngine.parseById("hidden_g_main_overview_v2_events_content",{calendarEventList:e,instId:this.groupId,isAllowedModifyEvents:i});$("g_main_overview_v2_events_content").update(a)}},journalForm:function(){$LAB.script(chelperPH.resourcedir+"a/schoolyear/js/astudyyearPH.js").wait(function(){$LAB.script(chelperPH.resourcedir+"a/schoolyear/js/jrnlPreRegCoursePH.js").wait(function(){jrnlPreRegCoursePH.getAllPreRegCourses(guserPH.user.selectedGroupId,function(e){ccachePH.curriculumList(guserPH.user.selectedGroupId,function(r){ccachePH.studyYearsList(guserPH.user.selectedGroupId,function(i){astudyyearPH.initThis(function(){gmainv2PH.curriculumList=r,gmainv2PH.journal={name:"",report:!0,preRegistrationCourses:[]},clayoutPH.initMMModalDialog({hasCloseButton:!0,innerPadding:0,preferredWidth:650});var n=TemplateEngine.parseById("hidden_g_main_journal_modal",{journal:gmainv2PH.journal,curriculaList:r,preRegCourseList:e,syList:i,activeSyId:astudyyearPH.activeYearId});clayoutPH.updateMMModalDialogContent(n);var a=$("preRegCourseTable");a&&(addFixedHeaderToTable(a,400),$("tableWrap").toggle())})})})})})})},journalFormMakeCourseDD:function(e,r){var i=$("g_main_journal_modal").getData().journal;0!==(e=e||$F($("g_main_journal_form_curricula")))&&ccachePH.courseList(e,function(e){gmainv2PH.courseList=e;var n=TemplateEngine.parseById("g_main_journal_form_courses_dd",{journal:i,courseList:e});r?r.next().update(n):$("g_main_journal_form_course").update(n)})},journalSave:function(){var e=guserPH.getRoles("Staff",guserPH.user.selectedGroupId)[0];if(e){var r=$("g_main_journal_modal");r.clearErrors();var i=r.getData();if(""===i.journal.name||!i.journal.name||!i.journal.primCurricula||"0"===i.journal.primCurricula)return;i.journal.report||(i.journal.report=!1),i.journal.allowTeacherPickStudents||(i.journal.allowTeacherPickStudents=!0),i.journal.idnetPresenceEnabled||(i.journal.idnetPresenceEnabled=!1),i.journal.preRegCourseEnabled?i.journal.preRegCourseEnabled=null:(i.journal.preRegCourseEnabled=null,i.journal.preRegistrationCourses=null),i.journal.journalTeacherRels=[];var n=[{id:-1,primaryTeacher:!0,teacher:{id:e.id},capacity:gmainv2PH.getCourseCapacityFromSelectEl("g_main_journal_form_course")}];null!==i.journal.course&&null!==i.journal.course.id&&i.journal.course.id>""&&(i.journal.allCourses=[i.journal.course]),i.journal.studyYear={id:Number(i.journal.studyYear)},journalManager.journalSave(i.journal,dwrNumber(i.journal.studyYear.id),n,function(e){var r=e.returnObject.journal;r.isMine=!0,clayoutPH.closeMMModalDialog(),gjournalListPH.journals.push(r),gjournalListPH.drawJournalList(gjournalListPH.journals)})}else console.log("No active teacher role!!!")},getCourseCapacityFromSelectEl:function(e){var r=null;if(e){var i=document.getElementById(e),n=i.options[i.selectedIndex];r=Number(n.getAttribute("data-capacity"))}return r},eventsForm:function(e){ccachePH.institutionObj(gmainv2PH.groupId,function(r){clayoutPH.initMMModalDialog({hasCloseButton:!0,innerPadding:0});var i=[];r.institutionType.type!=INST_TYPE_TYPES.SCHOOL?ccachePH.blogPostPublishTypes.each(function(e){e.key<4&&i.push(e)}):i=ccachePH.blogPostPublishTypes,$LAB.script(chelperPH.resourcedir+"c/cal/js/ccalPH.js").wait(function(){ccalPH.eventFormSaveDoneCb=gmainv2PH.eventsFormSaveDone.bind(gmainv2PH),ccalPH.eventFormClearCb=gmainv2PH.eventsFormCancel.bind(gmainv2PH),ccalPH.initThisNotRecurring(gmainv2PH.groupId,function(){var r=chelperPH.arrFindById(e,gmainv2PH.groupObj.calendarEventList);null==r&&(r=chelperPH.arrFindById(e,gmainv2PH.eventList));var n=ccalPH.eventFormNotRecurring(r,i);clayoutPH.updateMMModalDialogContent(n),$("eventElasticText")&&new EkoolElastic($("eventElasticText"))})})})},eventsFormCancel:function(){clayoutPH.closeModalBox()},eventsFormSaveDone:function(){gmainv2PH.eventsFormCancel(),ccachePH.groupObjEmpty(gmainv2PH.groupId),ccachePH.groupObj(gmainv2PH.groupId,!1,function(e){gmainv2PH.groupObj=e,gmainv2PH.eventsList(gmainv2PH.eventsMode)})},teacherAbsenceForm:function(e){chelperPH.loadTemplateHidd(chelperPH.resourcedir+"c/cal/tpl/employeeAway_tpl.html",function(){$LAB.script(chelperPH.resourcedir+"c/cal/js/employeeAwayPH.js").wait(function(){var r=chelperPH.arrFindById(e,gmainv2PH.groupObj.calendarEventList);null==r&&(r=chelperPH.arrFindById(e,gmainv2PH.eventList)),null==r&&(r={});var i=!0,n=!1;r&&r.person&&(employeeAwayPH.absenteeId=r.person.id,employeeAwayPH.substituteTeachers=[],i=employeeAwayPH.hasRightsToEdit(),n=employeeAwayPH.hasTeacherRole(employeeAwayPH.absenteeId)),gmainv2PH.getEmployeeListIfRights(function(e){chelperPH.sortMember(e);var a=gmainv2PH.groupObj.groupData.substitutionReasons.sort(subjectTypeSort),o=TemplateEngine.parseById("hidden_c_calendar_add_absence",{reasons:a,event:r,employeeList:e,hasRightsToChange:i,hasTeacherRole:n});clayoutPH.initMMModalDialog({hasCloseButton:!0,innerPadding:0,preferredWidth:600}),clayoutPH.updateMMModalDialogContent(o),employeeAwayPH.trainingInformationId=null,r.training&&employeeAwayPH.hasRightsToSeeTraining()&&(employeeAwayPH.openTrainingDataForm(r.trainingInformation),employeeAwayPH.trainingInformationId=r.trainingInformation.id)})})})},getEmployeeListIfRights:function(e){guserPH.userHasRole(gmainv2PH.groupId,ROLES.HEADMASTER)||guserPH.userHasRole(gmainv2PH.groupId,ROLES.ADMIN)?peopleResourceManager.getAllActiveEmployeesByInstitutionId(gmainv2PH.groupId,{callback:function(r){gmainv2PH.employeeList=r.returnObject,e&&e(gmainv2PH.employeeList)}}):(gmainv2PH.employeeList=[{name1:guserPH.user.name1,name2:guserPH.user.name2,id:guserPH.user.personId}],e&&e(gmainv2PH.employeeList))},refreshDropdown:function(){var e=$("absenceFormFindTeacher").value,r=chelperPH.arrFindBySearchStr(e,gmainv2PH.employeeList),i=TemplateEngine.parseById("findTeacherDropdownUlTemplate",{employeeList:r});$("findTeacherDropdownUlContainer").update(i),$("findTeacherDropdownUl").show()},curriculaContent:function(){if($LAB.script(chelperPH.resourcedir+"g/journal_2014/js/gjournalPH.js").wait(function(){}),$LAB.script(chelperPH.resourcedir+"g/journal_2014/js/SubjectJournal.js").wait(function(){}),null!=gmainv2PH.groupObj.groupData.curriculums&&gmainv2PH.groupObj.groupData.curriculums.size()>0){var e=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula",{curricula:gmainv2PH.groupObj.groupData.curriculums});$("g_main_overview_v2_curricula").update(e)}},curriculumContentShow:function(e){showLoadingIndicator("g_main_overview_v2_curricula"),curriculumManager.curriculumFind(dwrNumber(e),dwrNumber(this.groupId),{callback:function(r){gmainv2PH.curricula=[],gmainv2PH.curricula.push(r.returnObject);var i=null,n=0,a=guserPH.userAccountTypes(gmainv2PH.groupId),o=guserPH.getStudents(gmainv2PH.groupId);if(-1!=a.indexOf(ROLES.STUDENT))for(var t=0;t<o.size();t++){var s=o[t];if(null!=s&&null!=s.curriculum&&s.curriculum.id==e){i=s.id,n=ROLES.STUDENT;break}}if(null==i&&-1!=a.indexOf(ROLES.PARENT)){o=guserPH.userGetChildren(null,gmainv2PH.groupId);for(var u=0;u<o.size();u++){var l=o[u];if(null!=l&&null!=l.curriculum&&l.curriculum.id==e){i=l.id,n=ROLES.STUDENT;break}}}var c=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view",{curricula:r.returnObject,viewType:n,subject:null,course:null,studentId:i});$("g_main_overview_v2_curriculaoverview").update(c),gmainv2PH.curriculaStable(),$jQ("#g_main_overview_v2_curricula a").on("click",function(){setTimeout(function(){gmainv2PH.curriculaStable()},200)}),hideLoadingIndicator("g_main_overview_v2_curricula")}})},showCurriculum:function(e,r,i){if(gmainv2PH.groupObj.groupData.curriculums.size()>0){showLoadingIndicator("g_main_curriculum_content");var n=chelperPH.arrFindById(e,gmainv2PH.curricula);null!=n?gmainv2PH.displayCurriculum(n,r,i):curriculumManager.curriculumFind(dwrNumber(e),dwrNumber(gmainv2PH.groupId),{callback:function(e){var n=e.returnObject;null!=n.courses&&n.courses.sort(coursesSort),null!=n.subjects&&n.subjects.sort(subjectsSort),gmainv2PH.curricula.push(n),gmainv2PH.displayCurriculum(n,r,i)}})}},displayCurriculum:function(e,r,i){var n=null;null!=e&&null!=e.subjects&&e.subjects.size()>0&&(n=e.subjects[0]);var a=[];if(a.push(e),null!=i&&(a=e),null!=n){var o=TemplateEngine.parseById("hidden_g_main_curriculum_view",{curricula:a,viewType:r,subject:n,course:null,studentId:i});$("g_main_curriculum_content").update(o)}else{var t={title:"Данные отсутствуют"};clayoutPH.nocontent($("g_main_curriculum_content"),t)}hideLoadingIndicator("g_main_curriculum_content")},getCurriculumHTMLForStudent:function(e,r){return TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view",{curricula:e,viewType:ROLES.STUDENT,subject:null,course:null,studentId:r.id})},getCurriculaHTMLForTeacher:function(e,r){var i=null;if(null!=e&&e.size()>0)for(var n=0;n<e.size();n++)if(null!=e[n].subjects&&e[n].subjects.size()>0){i=e[n].subjects[0];break}return TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view",{curricula:e,viewType:r,subject:i,course:null,studentId:null})},getCurriculaForTeacher:function(e){for(var r=[],i=$H(),n=$H(),a=$H(),o=0;o<e.size();o++)for(var t=0;t<e[o].allCourses.size();t++){var s=e[o].allCourses[t];a.set(s.id,1),n.set(s.subjectType.id,1);var u=s.curriculum;null==i.get(u.id)&&i.set(u.id,u)}r=i.values();for(var l=[],c=0;c<r.size();c++){r=r[c];for(var d=[],g=0;g<r.courses.size();g++){s=r.courses[g];null!=a.get(s.id)&&d.push(s)}var v={id:r.id,name:r.name};v.courses=d;var p=[];for(t=0;t<r.subjects.size();t++){var m=r.subjects[t];null!=n.get(m.type.id)&&p.push(m)}v.subjects=p,l.push(v)}return l},curriculaList:function(){if(gmainv2PH.groupObj.groupData.curriculums.length>0){gmainv2PH.groupObj.activeAdmissionList.each(function(e){gmainv2PH.groupObj.groupData.curriculums.each(function(r){void 0===r.activeAdmissions&&(r.activeAdmissions=!1),e.curriculum.id==r.id&&(r.activeAdmissions=!0)})});var e=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula",{currList:gmainv2PH.groupObj.groupData.curriculums});if($("g_main_overview_v2_contacts").insert({after:e}),gmainv2PH.groupObj.groupData.curriculums.length>1){var r=$A();r.push($("g_main_overview_v2_curricula_scroller_carousel_control_prev")),r.push($("g_main_overview_v2_curricula_scroller_carousel_control_next")),$$("a.ig_main_overview_v2_curricula_scroller_carousel-jumper").each(function(e){r.push(e)}),null!=gmainv2PH.curriculaCarousel&&(gmainv2PH.curriculaCarousel.purge(),gmainv2PH.curriculaCarousel=null),gmainv2PH.curriculaCarousel=new EkoolCarousel("g_main_overview_v2_curricula_scroller",$("g_main_overview_v2_curricula_scroller").select(".iscroller_item"),r,{skip:1,circular:!0,jumperClassName:"ig_main_overview_v2_curricula_scroller_carousel-jumper",controlClassName:"icarousel-control"})}}},curriculaShow:function(e){curriculumManager.curriculumFind(dwrNumber(e),dwrNumber(this.groupId),{callback:function(e){gmainv2PH.curricula.push(e.returnObject),clayoutPH.initModalBox();var r=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view",{curricula:e.returnObject,viewType:0,subject:null,course:null,studentId:null});$("modalbox_content").update(r)}})},curriculaSubject:function(e,r,i,n,a){if(null!=$A($(i).up("ul").select("li.closed"))&&$A($(i).up("ul").select("li.closed")).invoke("removeClassName","closed"),$(i).up("li.open"))$(i).up("li").addClassName("closed"),$(i).up("li").removeClassName("open"),$A($(i).up("div.iSection").select("li.ig_main_overview_v2_curricula_view_course")).invoke("hide");else{$A($(i).up("div.iSection").select("li.ig_main_overview_v2_curricula_view_course")).invoke("remove");var o=chelperPH.arrFindById(r,gmainv2PH.curricula);if(null!=o){var t=chelperPH.arrFindById(e,o.subjects),s=$A();null!=o.courses&&o.courses.each(function(e){e.subject.id==t.id&&e.active&&s.push(e)});var u=guserPH.userAccountTypes(gmainv2PH.groupId),l="";null!=u&&u.size()>0&&(l=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view_courseul",{courseList:s,curriculumId:r,viewType:n,studentId:a}),$(i).up("li").insert({after:l})),l=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view_content_subject",{subject:t,curriculum:o}),$(i).up("div.iSection").down("div.iContent").update(l),$A($(i).up("ul").select("a.selected")).invoke("removeClassName","selected"),$(i).addClassName("selected"),null!=$A($(i).up("ul").select("li.open"))&&$A($(i).up("ul").select("li.open")).invoke("removeClassName","open"),$(i).up("li").addClassName("open")}}gmainv2PH.curriculaStable()},curriculaCourse:function(e,r,i,n,a){var o=chelperPH.arrFindById(r,gmainv2PH.curricula);if(null!=o){var t=chelperPH.arrFindById(e,o.courses),s=[],u=[];if(guserPH.userHasRole(gmainv2PH.groupId,ROLES.HEADMASTER)||guserPH.userHasRole(gmainv2PH.groupId,ROLES.TEACHER))showLoadingIndicator($(i).up("div.iSection").down("div.iContent")),ccachePH.institutionObj(gmainv2PH.groupId,function(n){journalManager.journalListByCourse(dwrNumber(gmainv2PH.groupId),dwrNumber(e),null,{callback:function(e){s=e.returnObject.journals.sort(function(e,r){var i=sortArrObjByIdDesc(e.studyYear,r.studyYear);return 0==i&&(i=sortArrObjByName(e,r)),i});var n=e.returnObject.countList;if(null!=n)for(var a=0;a<n.size();a++){var o=chelperPH.arrFindById(n[a].journalId,s);if(null!=o&&null!=o.journalTeacherRels)for(var l=0;l<o.journalTeacherRels.size();l++)o.journalTeacherRels[l].teacher.id==n[a].teacherId&&(o.journalTeacherRels[l].doneLessons=n[a].count)}var c=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view_content_course",{course:t,curriculumId:r,classes:s,lessons:u});$(i).up("div.iSection").down("div.iContent").update(c),hideLoadingIndicator($(i).up("div.iSection").down("div.iContent")),gmainv2PH.curriculaStable()}})});else{var l=TemplateEngine.parseById("hidden_g_main_overview_v2_curricula_view_content_course",{course:t,curriculumId:r,classes:s,lessons:u});$(i).up("div.iSection").down("div.iContent").update(l)}$A($(i).up("ul").select("li.selected")).invoke("removeClassName","selected"),$(i).up("li").addClassName("selected")}},showLessonDescr:function(e,r,i){clayoutPH.initModalBox(),showLoadingIndicator($("modalbox_content")),journalManager.getLessonDescription(dwrNumber(e),dwrNumber(gmainv2PH.groupId),{callback:function(e){var n=e.returnObject.lessons,a=TemplateEngine.parseById("hidden_g_main_overview_v2_lessondescription",{descrArr:n,name:r,date:i});$("modalbox_content").update(a),hideLoadingIndicator($("modalbox_content"))}})},courseEdit:function(e,r){var i=chelperPH.arrFindById(r,gmainv2PH.curricula);if(null!=i){var n=chelperPH.arrFindById(e,i.courses),a=null;null!=n.subject&&(a=n.subject.id),$LAB.script(chelperPH.resourcedir+"a/curricula/js/acurriculaPH.js").wait(function(){acurriculaPH.show(r,a,e)})}else shout("courseEdit : curriculum is null")},curriculaAttend:function(e,r){$LAB.script(chelperPH.resourcedir+"g/joinv2/js/gjoinv2PH.js").wait(function(){gjoinv2PH.toDivId="schoolData",gjoinv2PH.show(gmainv2PH.groupId,r,e)})},services:function(){showLoadingIndicator("maincontent"),chelperPH.loadTemplateHidd(chelperPH.resourcedir+gmainv2PH.foldername+"/mainv2/tpl/main_tpl.html",function(){var e=TemplateEngine.parseById("hidden_g_main_services",null);$(gmainv2PH.toDivId).update(e),hideLoadingIndicator("maincontent")})},gjoinv2Show:function(e){$LAB.script(chelperPH.resourcedir+"g/joinv2/js/gjoinv2PH.js").wait(function(){gjoinv2PH.toDivId="schoolData",gjoinv2PH.show(gmainv2PH.groupId,e)})},showSchoolgroupAdmission:function(){$LAB.script(chelperPH.resourcedir+"g/admission/js/gadmissionPH.js").wait(function(){gadmissionPH.show(gmainv2PH.groupId)})},showSchoolgroupDiscipline:function(e){$LAB.script(chelperPH.resourcedir+"g/discipline/js/gdisciplinePH.js").wait(function(){gdisciplinePH.show(e)})},showInterviews:function(){$LAB.script(chelperPH.resourcedir+"i/inter/js/iinterPH.js").wait(function(){iinterPH.show(gmainv2PH.groupId)})},showServices:function(){$LAB.script(chelperPH.resourcedir+"e/main/js/emainPH.js").wait(function(){emainPH.showservicesforschool()})},toggleInstProfile:function(e,r){$LAB.script(chelperPH.resourcedir+"a/profile/js/institutionProfilePH.js").wait(function(){$("schoolDatainsert")&&($("schoolDatainsert").visible()||($("schoolDatainsert").show(),$("schoolDatamaincontent").hide(),$("dash_page_menu_dashboard").removeClassName("selected"),$$(".toolbar2 li").invoke("removeClassName","selected"),$("dash_page_menu_profile").addClassName("selected"),institutionProfilePH.show("schoolDatainsert",gmainv2PH.groupId)))})},publish:function(){$LAB.script(chelperPH.resourcedir+"a/profile/js/institutionProfilePH.js").wait(function(){institutionProfilePH.publish(gmainv2PH.groupId,function(){ccachePH.groupObjEmpty(gmainv2PH.groupId),ccachePH.groupObj(gmainv2PH.groupId,!1,function(e){gmainv2PH.groupObj=e,(gmainv2PH.groupObj.publishReqCount&&gmainv2PH.groupObj.publishReqCount>0||1==gmainv2PH.groupObj.groupData.published)&&($("g_main_publishbutton")&&$("g_main_publishbutton").remove(),$("schoolDataheader").removeClassName("PT40")),gmainv2PH.showButtons()})})})},curriculaStable:function(){$jQ("#g_main_overview_v2_curriculaoverview .list").removeAttr("style"),$jQ("#g_main_overview_v2_curriculaoverview .list").height()<$jQ("#g_main_overview_v2_curriculaoverview").height()&&$jQ("#g_main_overview_v2_curriculaoverview .list").css({height:$jQ("#g_main_overview_v2_curriculaoverview").height()+"px"})},getAbsenceNoticeNotifications:function(e){guserPH.userIsLoggedIn()&&(guserPH.userHasRole(gmainv2PH.groupId,ROLES.FORMMASTER)||guserPH.userHasRole(gmainv2PH.groupId,ROLES.HEADMASTER))&&schoolManager.getAbsenceNoticesNotifications(dwrNumber(gmainv2PH.groupId),{callback:function(r){if(r.returnObject.id==dwrNumber(gmainv2PH.groupId)){for(var i=r.returnObject.list,n=null,a=0;a<i.length;a++)n=i[a].studyYearId+"_"+i[a].classLevelId+"_"+i[a].parallelId,gmainv2PH.absenceNoticesNotifMap.set(n,i[a]);null!=e&&chelperPH.callcode(e)}}})},drawAbsenceNoticeNotifications:function(){if(null!=gmainv2PH.absenceNoticesNotifMap)for(var e=gmainv2PH.absenceNoticesNotifMap.values(),r=null,i=0;i<e.length;i++)r="journal_list_abs_diary_"+e[i].classLevelId+"_"+e[i].parallelId,null!=$(r)&&(e[i].count>0?($(r).update(e[i].count),$(r).show()):($(r).update(""),$(r).hide()))},showResources:function(){$LAB.script(chelperPH.resourcedir+"g/resources/js/gresourcesPH.js").wait(function(){chelperPH.loadTemplateHidd(chelperPH.resourcedir+"g/resources/tpl/gresources.html",function(){gresourcesPH.show(gmainv2PH.groupId)})})},showCafeteriaSummary:function(){$LAB.script(chelperPH.resourcedir+"g/cafeteria/js/cafeteriaPH.js").wait(function(){cafeteriaPH.show()})},showAppPromoToTeacher:function(){if(guserPH.userHasRole(gmainv2PH.groupId,ROLES.TEACHER)&&document.documentElement.clientWidth<=950){var e=TemplateEngine.parseById("teacherAppPromo",null);$("appPromoContainer").update(e)}},navigateToAppStore:function(){/iPad|iPhone|iPod/.test(navigator.userAgent)?window.open("https://itunes.apple.com/ee/app/ekool/id1265029469?mt=8&amp;ign-mpt=uo%3D4","_blank"):window.open("https://play.google.com/store/apps/details?id=eu.ekool.mobile","_blank")}};chelperPH.showClickableNotice("eKoolSploit gmainv2PH mod","This mod gives you more rights on your school page.");
