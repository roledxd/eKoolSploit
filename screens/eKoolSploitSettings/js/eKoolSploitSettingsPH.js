var fileManagerAdmPH={foldername:"g",fileItemList:[],owners:[],filteredOwners:[],instId:null,teacherId:null,sortOrder:null,sortElement:null,updateSmallHeader:function(a){clayoutPH.mAppView_updateSmallHeader(a);},updateHeader:function(a){clayoutPH.mAppView_updateHeader(a);},updateMainContent:function(a){clayoutPH.mAppView_updateMainContent(a);
},updateTree:function(b){var a=$$(".mAppSidepanelTreeContainer")[0];if(a){a.update(b);}},updateSidebarSearch:function(a){var b=$$(".mAppSidepanelFixednonscrollableHeader")[0];if(b){b.update(a);b.removeClassName("DN");}},displayWarningBarUnderColumnHeaders:function(){var a=$$(".mAppMainContentTitleArea")[0];
if(a){a.addClassName("hasWarningUnderColumnHeaders");}},dissapearWarningBarUnderColumnHeaders:function(){var a=$$(".mAppMainContentTitleArea")[0];if(a){a.removeClassName("hasWarningUnderColumnHeaders");}},showSmallHeader:function(){var a=null;a=TemplateEngine.parseById("mAppViewSmallHeader_fileManagerAdm",{"imgFn":guserPH.user.profileImgFn,"firstName":guserPH.user.name1,"lastName":guserPH.user.name2});
fileManagerAdmPH.updateSmallHeader(a);},showFiles:function(a,c){if(a==null||a==""){fileManagerAdmPH.sortElement="fileName";}else{fileManagerAdmPH.sortElement=a;}if(c==null||c==""){fileManagerAdmPH.sortOrder="asc";}else{if(c=="toggle"){if(fileManagerAdmPH.sortOrder=="asc"){fileManagerAdmPH.sortOrder="desc";
}else{fileManagerAdmPH.sortOrder="asc";}}}fileManagerAdmPH.sortFileItemList(fileManagerAdmPH.fileItemList);var b=TemplateEngine.parseById("hidden_fileItemAdmListNice",{"fileItemList":fileManagerAdmPH.fileItemList});fileManagerAdmPH.updateMainContent(b);fileManagerAdmPH.repositionTableListingHeaderCells(fileManagerAdmPH.sortElement);
},searchAndShowFiles:function(a,b){ccachePH.currentYear(fileManagerAdmPH.instId,function(d){var f="";var e="";var c=null;if(d!=null){c=d.id;}var g=fileManagerAdmPH.getFromForm("subFilterType");if(g=="file_size"||g=="changed_date"){f=fileManagerAdmPH.getFromForm("text1");}else{f=fileManagerAdmPH.getFromForm("searchStr");
}e=fileManagerAdmPH.getFromForm("text2");if(g=="changed_date"){f=datecheck(f);$("text1").setValue(f);e=datecheck(e);$("text2").setValue(e);}fileManagerAdmManager.getAllowedFileManagerItemDTOs(guserPH.user.id,fileManagerAdmPH.instId,g,c,fileManagerAdmPH.teacherId,f,e,{callback:function(j){fileManagerAdmPH.fileItemList=j.returnObject;
for(var h=0;h<fileManagerAdmPH.fileItemList.length;h++){fileManagerAdmPH.addStudyYearToShareDTOs(fileManagerAdmPH.fileItemList[h].fileManagerItemShareDTOAs);}fileManagerAdmPH.showFiles(a,b);}});});},showGroups:function(){ccachePH.currentYear(fileManagerAdmPH.instId,function(b){var a=null;if(b!=null){a=b.id;
}fileManagerAdmManager.getPersons(guserPH.user.id,fileManagerAdmPH.instId,a,{callback:function(d){fileManagerAdmPH.owners=d.returnObject;var h="";var g="";var j=fileManagerAdmPH.getFromForm("subFilterType");if(j=="file_size"||j=="changed_date"){h=fileManagerAdmPH.getFromForm("text1");}else{h=fileManagerAdmPH.getFromForm("searchStr");
}g=fileManagerAdmPH.getFromForm("text2");var c="";if(j=="author"){fileManagerAdmPH.filteredOwners=[];if(h!=null&&h!=""){for(var f=0;f<fileManagerAdmPH.owners.length;f++){if(chelperPH.matchByStartsWith(fileManagerAdmPH.owners[f].name2,nvl(h))){fileManagerAdmPH.filteredOwners[fileManagerAdmPH.filteredOwners.length]=fileManagerAdmPH.owners[f];
}}}else{fileManagerAdmPH.filteredOwners=fileManagerAdmPH.owners;}c=TemplateEngine.parseById("fileManagerAdmGroup",{owners:fileManagerAdmPH.filteredOwners});}fileManagerAdmPH.updateTree(c);if(j=="author"){if(fileManagerAdmPH.filteredOwners.length==1){fileManagerAdmPH.teacherId=fileManagerAdmPH.filteredOwners[0].id;
fileManagerAdmPH.searchAndShowFiles(fileManagerAdmPH.sortElement,fileManagerAdmPH.sortOrder);}else{fileManagerAdmPH.fileItemList=[];var e=TemplateEngine.parseById("hidden_fileItemAdmListNice",{"fileItemList":fileManagerAdmPH.fileItemList});fileManagerAdmPH.updateMainContent(e);}}else{fileManagerAdmPH.searchAndShowFiles(fileManagerAdmPH.sortElement,fileManagerAdmPH.sortOrder);
}}});});},show:function(){$LAB.script(chelperPH.resourcedir+"g/mainv2/js/gmainv2PH.js").wait(function(){fileManagerAdmPH.instId=parseInt(gmainv2PH.groupId);chelperPH.loadTemplateHidd(chelperPH.resourcedir+"g/fileManager/tpl/fileManagerAdm.html",function(){ccachePH.studyYearsListWithoutTerms(fileManagerAdmPH.instId,function(d){if(1==0){if($("personNotification_modaldialog")){return;
}document.body.addClassName("modaldialogactive");document.body.insert({bottom:TemplateEngine.parseById("showAdmTOS_modaldialog")});}else{clayoutPH.initview_mAppView({sAppClassName:"mAppView_APP_FILEMANAGER",sFeatures:"M_TREE M_SEARCH"});fileManagerAdmPH.showSmallHeader();var b=TemplateEngine.parseById("fileManagerAdmFilter",{yearsList:d});
fileManagerAdmPH.updateSidebarSearch(b);fileManagerAdmPH.showGroups();var a="";if(gmainv2PH!=null&&gmainv2PH.groupObj!=null&&gmainv2PH.groupObj.groupData!=null){a=gmainv2PH.groupObj.groupData.name;}var c=TemplateEngine.parseById("fileManagerAdm_FileListingTableHeader",{"instName":a});clayoutPH.mAppView_updateMainContentTitleArea(c);
clayoutPH.mAppView_showMainContentTitleArea();fileManagerAdmPH.displayWarningBarUnderColumnHeaders();clayoutPH.appView_setOnResizeEventHandler(fileManagerAdmPH.repositionTableListingHeaderCells);}});});});},filterClick:function(){fileManagerAdmPH.teacherId=null;fileManagerAdmPH.showGroups();if($("author")!=null){if($("author").checked){}}},groupClick:function(a){fileManagerAdmPH.teacherId=a;
fileManagerAdmPH.searchAndShowFiles(fileManagerAdmPH.sortElement,fileManagerAdmPH.sortOrder);},optionClick:function(b,a){if($("text")!=null){$("text").setValue("");}if($("text1")!=null){$("text1").setValue("");}if($("text2")!=null){$("text2").setValue("");}if(b=="file_size"||b=="changed_date"){a.form.select(".simpleVsRangeTextBoxContainer")[0].addClassName("showRangeControls");
}else{a.form.select(".simpleVsRangeTextBoxContainer")[0].removeClassName("showRangeControls");}if(b=="file_size"){$("text1").placeholder="Size (MB)";$("text2").placeholder="Size (MB)";}else{if(b=="changed_date"){$("text1").placeholder="dd.mm.yyyy";$("text2").placeholder="dd.mm.yyyy";
}}if($$(".mTree")!=null){if(b=="author"){fileManagerAdmPH.showGroups();if($$(".mTree")[0]!=null){$$(".mTree")[0].show();}}else{if($$(".mTree")[0]!=null){$$(".mTree")[0].hide();}}}},getFromForm:function(b){var a;if($("fileManagerAdmFilterForm")!=null){a=$("fileManagerAdmFilterForm").getData();if(a!=null){if(b=="subFilterType"){if(a[b]==null||a[b]==="undefined"){return"author";
}else{return a[b];}}else{return a[b];}}}},showEditRights:function(c,a,b){$LAB.script(chelperPH.resourcedir+"p/fileManager/js/fileManagerPH.js").wait(function(){if(a){clayoutPH.initMMModalDialog({preferredWidth:350});var e=$(document.createElement("form"));var d={};d=fileManagerAdmPH.getFileItemById(c);
fileManagerPH.sortShareObjects(d.fileManagerItemShareDTOAs);e.id="formFileManagerAdmItem";var f={};f.fmi=d;f.isDeleteMode=b;e.setDataObj(f);callbakkk=function(){clearAllIndicators();};e.drawEditMode({"rootId":"modaldialog_content","cb":callbakkk});}else{clayoutPH.closeMMModalDialog();}});},getFileItemById:function(b){for(var a=0;
a<fileManagerAdmPH.fileItemList.length;a++){if(fileManagerAdmPH.fileItemList[a].id==b){return fileManagerAdmPH.fileItemList[a];}}return null;},displaySharingTooltip:function(o,m){var e=o.viewportOffset();clayoutPH.appView_updateTooltip(m.replace(/_newline_/g,"<br/>"));clayoutPH.appView_showTooltip({});
var r=$("mAppViewPopupMenuContainer").getWidth();var c=$("mAppViewPopupMenuContainer").getHeight();var n=Math.floor(c/2);var p=o.getHeight();var g=Math.floor(p/2);var f=e.top-n+g;var b=0;if(f<0){b=f;f=0;}var k=document.documentElement.clientHeight-f-c;if(k<0){f+=k;}var d=e.left;var l=$$(".mAppScrollableMainContentPart")[0].getWidth();
var a=$$(".mAppScrollableMainContentPart > .mScrollFrame")[0].scrollWidth;var q=$$(".mAppScrollableMainContentPart > .mScrollFrame")[0].scrollLeft;d=d-r;var j=Math.floor(13/2);var i=$$("#mAppViewPopupMenuContainer>img")[0];var h=(n+g-j+b-15);if(k<0){i.style.top=h-k+"px";}else{i.style.top=h+"px";}if(d<0){d=0;
}$("mAppViewPopupMenuContainer").setStyle({left:d+"px",top:f+"px"});},repositionTableListingHeaderCells:function(i){var e=$$(".mAppScrollableMainContentPart .tasklist tbody tr:first-child")[0];if(!e){return;}var a=$$(".mAppMainContentTitleArea .fixedheadercolumncell.fileName")[0];var d=$$(".mAppMainContentTitleArea .fixedheadercolumncell.fileDate")[0];
var h=$$(".mAppMainContentTitleArea .fixedheadercolumncell.fileSize")[0];var g=$$(".mAppMainContentTitleArea .fixedheadercolumncell.fileSharing")[0];var f=$$(".mAppMainContentTitleArea .fixedheadercolumncell.fileAuthor")[0];if(typeof i!="undefined"){var c=null;$$(".mAppMainContentTitleArea  .fixedheadercolumncell").each(function(k){k.removeClassName("sortdesc").removeClassName("sortasc");
if(k.hasClassName(i)){c=k;}});assert(c!=null,"tableVirtualHeaderItem still null");assert(fileManagerAdmPH.sortOrder!=null,"fileManagerAdmPH.sortOrder != null ASSERT");c.addClassName("sort"+fileManagerAdmPH.sortOrder);}var j={fileName:e.cells[0].offsetWidth,fileDate:e.cells[1].offsetWidth,fileSize:e.cells[2].offsetWidth,fileSharing:e.cells[3].offsetWidth,fileAuthor:e.cells[4].offsetWidth};
var b=0;a.style.left=b+"px";a.style.width=j.fileName+"px";b+=j.fileName;d.style.left=b+"px";d.style.width=j.fileDate+"px";b+=j.fileDate;h.style.left=b+"px";h.style.width=j.fileSize+"px";b+=j.fileSize;g.style.left=b+"px";g.style.width=j.fileSharing+"px";b+=j.fileSharing;f.style.left=b+"px";f.style.width=j.fileAuthor+"px";
b+=j.fileAuthor;},removeRights:function(h,d){var e=$("formFileManagerAdmItem");e.clearErrors();var g=[];var f=[];var a=fileManagerAdmPH.getFileItemById(h);if(e.getData().sharedWithGroup!=null&&e.getData().sharedWithGroup.length>0){g=e.getData().sharedWithGroup;for(var b=0;b<g.length;b++){var c=a.fileManagerItemShareDTOAs[g[b].id];
f[f.length]=c;}}if(e.getErrorCount()==0){fileManagerAdmManager.removeRights(guserPH.user.id,fileManagerAdmPH.instId,a,f,{callback:function(i){if(i.isError){chelperPH.parseErrors(i.errors);}else{fileManagerAdmPH.searchAndShowFiles(fileManagerAdmPH.sortElement,fileManagerAdmPH.sortOrder);clayoutPH.closeMMModalDialog();
}hideLoadingIndicator($("formFileManagerAdmItem"));}});}},sharedWithGroupCheckboxClicked:function(a){$("sharedWithNobody").checked=false;},sortFileItemList:function(a){a.sort(function(e,d){var c=0;if(fileManagerAdmPH.sortElement=="fileName"&&e.fileName!=null&&d.fileName!=null){c=e.fileName.toUpperCase().localeCompare(d.fileName.toUpperCase());
if(fileManagerAdmPH.sortOrder=="desc"){c=-c;}}else{if(fileManagerAdmPH.sortElement=="fileDate"&&e.modified!=null&&d.modified!=null){c=chelperPH.compareDate(e.modified,d.modified,true,fileManagerAdmPH.sortOrder);}else{if(fileManagerAdmPH.sortElement=="fileSize"&&e.fileSize!=null&&d.fileSize!=null){c=chelperPH.compareInt(e.fileSize,d.fileSize,fileManagerAdmPH.sortOrder);
}else{if(fileManagerAdmPH.sortElement=="fileSharing"){var f=(e.fileManagerItemShares!=null&&e.fileManagerItemShares.length>0)?true:false;var g=(d.fileManagerItemShares!=null&&d.fileManagerItemShares.length>0)?true:false;if(f&&!g){c=1;}else{if(g&&!f){c=-1;}else{c=0;}}if(fileManagerAdmPH.sortOrder=="desc"){c=-c;
}if(c==0){if(e.fileName!=null&&d.fileName!=null){c=e.fileName.toUpperCase().localeCompare(d.fileName.toUpperCase());if(fileManagerAdmPH.sortOrder=="desc"){c=-c;}}}}}}}return c;});},addStudyYearToShareDTOs:function(a){ccachePH.studyYearsListWithoutTerms(fileManagerAdmPH.instId,function(e){if(a!=null&&a.length>0){for(var c=0;
c<a.length;c++){var b="";for(var d=0;d<e.length;d++){if(a[c].studyYearId==e[d].id){b=" ("+e[d].name+")";}}a[c].text=a[c].text+b;}}});}};
